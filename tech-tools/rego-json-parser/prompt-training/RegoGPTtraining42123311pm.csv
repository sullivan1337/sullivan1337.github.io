prompt,completion
"Use OPA's rego policy language, and always follow all rules below:

Rego Rule building blocks:
1. Each rule must start with \`package wiz\`
2. \`result\` = mandatory variable that controls the status of the rule
3. \`currentConfiguration := ""abc""\` and \`expectedConfiguration := ""xyz""\` Output additional context, guidance and information from the Rule which are shown when a Configuration Finding is generated by the Rule. This can use the Rule's variables or plain text.
4. Rather than \`compliant\` and \`noncompliant\` status, make the result return \`pass\`, \`fail\`, or \'skip\' (Resources should be skipped when it wouldn't make sense for the Cloud Configuration Rule to assess them at all. For instance, the built-in Cloud Configuration Rule for default security group should have no rules configured evaluates EC2 Security Groups but skips all non-default groups.)
5. Basic functions relating to time:


time.now_ns() # current time since epoch in nanoseconds
time.parse_duration_ns(duration) # duration valid time units:""s"",""m"",""h""(""-1h"",""2h4m"")
time.parse_rfc3339_ns(value) # representing the time value in nanoseconds since epoch
For instance, if you wanted to check that secret keys are rotated at least every 90 days:

default result = ""pass""

now_ns := time.now_ns()
ninty_days_ns := time.parse_duration_ns(""2160h"") # 90d in hours

result = ""fail"" {
    (now_ns - time.parse_rfc3339_ns(input.timeCreated)) > ninty_days_ns
}
6. The following is an example of a good working rego rule: 
\`\`\`
package wiz

default result = ""pass""

validFlowLogConfig {
    input.enableFlowLogs
    input.logConfig.aggregationInterval == ""INTERVAL_5_SEC""
    input.logConfig.flowSampling == 1
    input.logConfig.metadata == ""INCLUDE_ALL_METADATA""
    count(input.logConfig.filterExpr) < 1
}

result = ""fail"" {
    input.purpose == ""PRIVATE""
    not validFlowLogConfig
}

currentConfiguration := ""The private subnet's flow logs configuration is missing or invalid""
expectedConfiguration := ""Flow logs should be configured""
\`\`\`
7. Reserved names
The following words are reserved and cannot be used for document names:
as
default
else
false
import
package
not
null
some
true
with

8. Operators & logical expressions
Rego offers many built-in logical expressions:


# These are logical expressions
x == y  # x is equal to y ({1,3,1,4} == {4,4,1,3,1} #true)
x != y  # x is not equal to y
x < y   # x is less than y
x <= y  # x is less than or equal to y

# Built-in set functions
s3 := s1 & s2   # s3 is the intersection of s1 and s2
s3 := s1 | s2   # s3 is the union of s1 and s2
s3 := s1 - s2   # s3 is the elements in s1 that are not in s2
One especially useful operator is not, which has several important behaviors:

not turns undefined into true
not turns false into true
not turns everything else into true

# Check if path does not exist
not input.foo.bar

# This is a negation of the return value of the called function
not myfunction

10. 
Logical evaluations
Every line of code in a policy performs a logical evaluation that returns either true or false. If the conditions in a rule never evaluate to true, the result is undefined. As a result, the document that would otherwise be defined by the rule's assignment remains undefined.


# Check if the value of foo equals the value bar, and returns a logical true
# Since the condition is true (foo and bar both equal 1), the assignment is performed
# The assignment overrides the default value of allow, changing it to true
default allow = false
foo := 1
bar := 1
allow = true {
  foo == bar
}

# The string ""hello"" does not equal the string ""world""
# Since the document undefinedDocument was not previously defined, it remains undefined
undefinedDocument { ""hello"" == ""world"" }",Sounds good! I'll follow those guidelines.
"""""name"" Subnets should not allow automatic public IP assignment ""description"" This rule checks whether VPC subnets are allowing automatic public IP assignment.
 
 VPC subnet is a part of the VPC having its own rules for traffic. Assigning the Public IP to the subnet automatically (on launch) can accidentally expose the instances within this subnet to the internet and should be edited to 'No' post creation of the subnet. ""exampleResourceJson"" ``` {
  ""data"": {
  ""graphSearch"": {
  ""nodes"": [
  {
  ""entities"": [
  {
  ""id"": ""4ed8695a-ace3-53a2-a6a9-268d9aed4912"",
  ""providerData"": {
  ""AssignIpv6AddressOnCreation"": false,
  ""AvailabilityZone"": ""us-east-1f"",
  ""AvailabilityZoneId"": ""use1-az5"",
  ""AvailableIpAddressCount"": 4091,
  ""CidrBlock"": ""172.31.64.0/20"",
  ""CustomerOwnedIpv4Pool"": null,
  ""DefaultForAz"": true,
  ""EnableDns64"": false,
  ""EnableLniAtDeviceIndex"": null,
  ""Ipv6CidrBlockAssociationSet"": null,
  ""Ipv6Native"": false,
  ""MapCustomerOwnedIpOnLaunch"": false,
  ""MapPublicIpOnLaunch"": true,
  ""OutpostArn"": null,
  ""OwnerId"": ""186300416549"",
  ""PrivateDnsNameOptionsOnLaunch"": {
  ""EnableResourceNameDnsAAAARecord"": false,
  ""EnableResourceNameDnsARecord"": false,
  ""HostnameType"": ""ip-name""
  },
  ""State"": ""available"",
  ""SubnetArn"": ""arn:aws:ec2:us-east-1:186300416549:subnet/subnet-03bf56db874d820a9"",
  ""SubnetId"": ""subnet-03bf56db874d820a9"",
  ""Tags"": null,
  ""VpcId"": ""vpc-03b62677b84ade81e"",
  ""WizMetadata"": {
  ""region"": ""us-east-1""
  }
  }
  }
  ]
  },
  {
  ""entities"": [
  {
  ""id"": ""e902e910-d028-546a-a562-3f24eac293a7"",
  ""providerData"": {
  ""AssignIpv6AddressOnCreation"": false,
  ""AvailabilityZone"": ""eu-west-2b"",
  ""AvailabilityZoneId"": ""euw2-az3"",
  ""AvailableIpAddressCount"": 4091,
  ""CidrBlock"": ""172.31.32.0/20"",
  ""CustomerOwnedIpv4Pool"": null,
  ""DefaultForAz"": true,
  ""EnableDns64"": false,
  ""EnableLniAtDeviceIndex"": null,
  ""Ipv6CidrBlockAssociationSet"": null,
  ""Ipv6Native"": false,
  ""MapCustomerOwnedIpOnLaunch"": false,
  ""MapPublicIpOnLaunch"": true,
  ""OutpostArn"": null,
  ""OwnerId"": ""186300416549"",
  ""PrivateDnsNameOptionsOnLaunch"": {
  ""EnableResourceNameDnsAAAARecord"": false,
  ""EnableResourceNameDnsARecord"": false,
  ""HostnameType"": ""ip-name""
  },
  ""State"": ""available"",
  ""SubnetArn"": ""arn:aws:ec2:eu-west-2:186300416549:subnet/subnet-058ef09bd0ee9395c"",
  ""SubnetId"": ""subnet-058ef09bd0ee9395c"",
  ""Tags"": null,
  ""VpcId"": ""vpc-023df4f18c5bfab1d"",
  ""WizMetadata"": {
  ""region"": ""eu-west-2""
  }
  }
  }
  ]
  },
  {
  ""entities"": [
  {
  ""id"": ""40aa9693-e583-5410-82ab-4b45bbbe8f60"",
  ""providerData"": {
  ""AssignIpv6AddressOnCreation"": false,
  ""AvailabilityZone"": ""ap-northeast-3b"",
  ""AvailabilityZoneId"": ""apne3-az1"",
  ""AvailableIpAddressCount"": 4091,
  ""CidrBlock"": ""172.31.16.0/20"",
  ""CustomerOwnedIpv4Pool"": null,
  ""DefaultForAz"": true,
  ""EnableDns64"": false,
  ""EnableLniAtDeviceIndex"": null,
  ""Ipv6CidrBlockAssociationSet"": null,
  ""Ipv6Native"": false,
  ""MapCustomerOwnedIpOnLaunch"": null,
  ""MapPublicIpOnLaunch"": true,
  ""OutpostArn"": null,
  ""OwnerId"": ""186300416549"",
  ""PrivateDnsNameOptionsOnLaunch"": {
  ""EnableResourceNameDnsAAAARecord"": false,
  ""EnableResourceNameDnsARecord"": false,
  ""HostnameType"": ""ip-name""
  },
  ""State"": ""available"",
  ""SubnetArn"": ""arn:aws:ec2:ap-northeast-3:186300416549:subnet/subnet-02ba1f71f03ecf3b4"",
  ""SubnetId"": ""subnet-02ba1f71f03ecf3b4"",
  ""Tags"": null,
  ""VpcId"": ""vpc-07ad5fe292396fccf"",
  ""WizMetadata"": {
  ""region"": ""ap-northeast-3""
  }
  }
  }
  ]
  },
  {
  ""entities"": [
  {
  ""id"": ""e400f6a9-44b4-522d-8c77-4c10679a0d65"",
  ""providerData"": {
  ""AssignIpv6AddressOnCreation"": false,
  ""AvailabilityZone"": ""us-east-2b"",
  ""AvailabilityZoneId"": ""use2-az2"",
  ""AvailableIpAddressCount"": 4090,
  ""CidrBlock"": ""172.31.16.0/20"",
  ""CustomerOwnedIpv4Pool"": null,
  ""DefaultForAz"": true,
  ""EnableDns64"": false,
  ""EnableLniAtDeviceIndex"": null,
  ""Ipv6CidrBlockAssociationSet"": null,
  ""Ipv6Native"": false,
  ""MapCustomerOwnedIpOnLaunch"": false,
  ""MapPublicIpOnLaunch"": true,
  ""OutpostArn"": null,
  ""OwnerId"": ""186300416549"",
  ""PrivateDnsNameOptionsOnLaunch"": {
  ""EnableResourceNameDnsAAAARecord"": false,
  ""EnableResourceNameDnsARecord"": false,
  ""HostnameType"": ""ip-name""
  },
  ""State"": ""available"",
  ""SubnetArn"": ""arn:aws:ec2:us-east-2:186300416549:subnet/subnet-f2c8ae88"",
  ""SubnetId"": ""subnet-f2c8ae88"",
  ""Tags"": null,
  ""VpcId"": ""vpc-cad7d7a2"",
  ""WizMetadata"": {
  ""region"": ""us-east-2""
  }
  }
  }
  ]
  },
  {
  ""entities"": [
  {
  ""id"": ""d661ca5b-adbe-52a5-af68-22ca8bd43b70"",
  ""providerData"": {
  ""AssignIpv6AddressOnCreation"": false,
  ""AvailabilityZone"": ""ca-central-1b"",
  ""AvailabilityZoneId"": ""cac1-az2"",
  ""AvailableIpAddressCount"": 4091,
  ""CidrBlock"": ""172.31.0.0/20"",
  ""CustomerOwnedIpv4Pool"": null,
  ""DefaultForAz"": true,
  ""EnableDns64"": false,
  ""EnableLniAtDeviceIndex"": null,
  ""Ipv6CidrBlockAssociationSet"": null,
  ""Ipv6Native"": false,
  ""MapCustomerOwnedIpOnLaunch"": false,
  ""MapPublicIpOnLaunch"": true,
  ""OutpostArn"": null,
  ""OwnerId"": ""186300416549"",
  ""PrivateDnsNameOptionsOnLaunch"": {
  ""EnableResourceNameDnsAAAARecord"": false,
  ""EnableResourceNameDnsARecord"": false,
  ""HostnameType"": ""ip-name""
  },
  ""State"": ""available"",
  ""SubnetArn"": ""arn:aws:ec2:ca-central-1:186300416549:subnet/subnet-074d340db6d7df67b"",
  ""SubnetId"": ""subnet-074d340db6d7df67b"",
  ""Tags"": null,
  ""VpcId"": ""vpc-09c7695f7ea919ad3"",
  ""WizMetadata"": {
  ""region"": ""ca-central-1""
  }
  }
  }
  ]
  }
  ]
  }
  }
 }``` ""remediationInstructions"" Perform the following command in order to disable automatic public IP assignment via AWS CLI: 
 ``` 
 aws ec2 modify-subnet-attribute --subnet-id {{subnetID}} --no-map-public-ip-on-launch 
 ``` ###""""","""package wiz

default result = """"pass""""

result = """"fail"""" { input.MapPublicIpOnLaunch == true } ###"""
""" ""name"" VPC subnet should have Private Google Access enabled ""description"" This rule checks whether the subnet has Private Google Access enabled, which allows access to Google APIs and services from an internal IP.  
This rule fails if it finds the field 'privateIpGoogleAccess = false'.
When disabled, VM instances without an external IP can not reach Goggle APIs and services, and can only send traffic within the VPC network. Private Google Access should be enabled to allow access to Google APIs without exposing an external IP. ""exampleResourceJson"" ```  {
  ""creationTimestamp"": ""2022-06-09T07:54:22.980-07:00"",
  ""description"": """",
  ""enableFlowLogs"": false,
  ""externalIpv6Prefix"": """",
  ""fingerprint"": ""83-ctFg6Ras="",
  ""gatewayAddress"": ""10.168.0.1"",
  ""internalIpv6Prefix"": """",
  ""ipCidrRange"": ""10.168.0.0/20"",
  ""ipv6AccessType"": """",
  ""ipv6CidrRange"": """",
  ""kind"": ""compute#subnetwork"",
  ""name"": ""default"",
  ""network"": ""https://www.googleapis.com/compute/v1/projects/eamon-wiz-test/global/networks/default"",
  ""privateIpGoogleAccess"": false,
  ""privateIpv6GoogleAccess"": ""DISABLE_GOOGLE_ACCESS"",
  ""purpose"": ""PRIVATE"",
  ""region"": ""https://www.googleapis.com/compute/v1/projects/eamon-wiz-test/regions/us-west2"",
  ""role"": """",
  ""selfLink"": ""https://www.googleapis.com/compute/v1/projects/eamon-wiz-test/regions/us-west2/subnetworks/default"",
  ""stackType"": ""IPV4_ONLY"",
  ""state"": """",
  ""WizMetadata"": {
    ""region"": ""us-west2""
  }
}```remediationInstructionsPerform the following command in order to enable Private Google Access via GCP CLI:  
```  
gcloud compute networks subnets update {{subnetName}} --region={{region}} --enable-private-ip-google-access  
```###""""","""package wiz

default result = ""pass""

result = ""fail"" {
	input.privateIpGoogleAccess == false
    input.creationTimestamp
}

currentConfiguration := ""privateIpGoogleAccess is set to False""
expectedConfiguration := ""privateIpGoogleAccess should be set to True""###"""
""" ""name"" Network Watcher is enabled ""description"" This rule checks whether Azure Network Watcher is enabled.  
This rule fails if Network Watcher is enabled.
>**Note**  
This rule is informational. It is used for the control `wc-id-1131`, and does not indicate a misconfiguration. ""exampleResourceJson"" ```  {
  ""NetworkWatchers"": null,
  ""displayName"": ""Norway East"",
  ""id"": ""/subscriptions/4ed8b4e8-a487-47e8-bc4a-fed262716d39/locations/norwayeast"",
  ""metadata"": {
    ""geographyGroup"": ""Europe"",
    ""latitude"": ""59.913868"",
    ""longitude"": ""10.752245"",
    ""pairedRegion"": [
      {
        ""id"": ""/subscriptions/4ed8b4e8-a487-47e8-bc4a-fed262716d39/locations/norwaywest"",
        ""name"": ""norwaywest""
      }
    ],
    ""physicalLocation"": ""Norway"",
    ""regionCategory"": ""Recommended"",
    ""regionType"": ""Physical""
  },
  ""name"": ""norwayeast"",
  ""regionalDisplayName"": ""(Europe) Norway East"",
  ""type"": ""Region"",
  ""WizMetadata"": {
    ""region"": null
  }
}```remediationInstructions###""""","""package wiz

default result = ""pass""

result = ""fail"" {
	count(input.NetworkWatchers) > 0
}

currentConfiguration := ""This region has network watcher enabled""
expectedConfiguration := """"
###"""